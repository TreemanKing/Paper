From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: TreemanKing <67459602+TreemanKing@users.noreply.github.com>
Date: Fri, 29 Sep 2023 01:57:24 +1000
Subject: [PATCH] Add MapCreationEvent


diff --git a/src/main/java/net/minecraft/world/item/EmptyMapItem.java b/src/main/java/net/minecraft/world/item/EmptyMapItem.java
index a87f4d82d4f6678b7c060de129997809d5722512..8a0e5452565b602c4d2af3b2b4573e926302c3b6 100644
--- a/src/main/java/net/minecraft/world/item/EmptyMapItem.java
+++ b/src/main/java/net/minecraft/world/item/EmptyMapItem.java
@@ -18,22 +18,28 @@ public class EmptyMapItem extends ComplexItem {
         if (world.isClientSide) {
             return InteractionResultHolder.success(itemStack);
         } else {
-            if (!user.getAbilities().instabuild) {
-                itemStack.shrink(1);
-            }
-
-            user.awardStat(Stats.ITEM_USED.get(this));
-            user.level().playSound((Player)null, user, SoundEvents.UI_CARTOGRAPHY_TABLE_TAKE_RESULT, user.getSoundSource(), 1.0F, 1.0F);
-            ItemStack itemStack2 = MapItem.create(world, user.getBlockX(), user.getBlockZ(), (byte)0, true, false);
-            if (itemStack.isEmpty()) {
-                return InteractionResultHolder.consume(itemStack2);
-            } else {
-                if (!user.getInventory().add(itemStack2.copy())) {
-                    user.drop(itemStack2, false);
+            // PC start
+            io.papermc.paper.event.player.MapCreationEvent mapCreationEvent = new io.papermc.paper.event.player.MapCreationEvent((org.bukkit.entity.Player) user.getBukkitEntity());
+            if (mapCreationEvent.callEvent()) {
+                if (!user.getAbilities().instabuild) {
+                    itemStack.shrink(1);
                 }
 
-                return InteractionResultHolder.consume(itemStack);
-            }
+                user.awardStat(Stats.ITEM_USED.get(this));
+                user.level().playSound((Player)null, user, SoundEvents.UI_CARTOGRAPHY_TABLE_TAKE_RESULT, user.getSoundSource(), 1.0F, 1.0F);
+                ItemStack itemStack2 = MapItem.create(world, user.getBlockX(), user.getBlockZ(), (byte)0, true, false);
+                if (itemStack.isEmpty()) {
+                    return InteractionResultHolder.consume(itemStack2);
+                } else {
+                    if (!user.getInventory().add(itemStack2.copy())) {
+                        user.drop(itemStack2, false);
+                    }
+
+                    return InteractionResultHolder.consume(itemStack);
+                }
+            } else {
+                return InteractionResultHolder.fail(itemStack);
+            } // PC end
         }
     }
 }
